<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Google zx ä¸­æ–‡ç‰ˆ | ä¸­æ–‡ front-end tech</title>
    <meta name="description" content="ä¸­æ–‡ description">
    <link rel="stylesheet" href="/vitepress-blog/assets/style.49eed234.css">
    <link rel="modulepreload" href="/vitepress-blog/assets/Home.d427a49b.js">
    <link rel="modulepreload" href="/vitepress-blog/assets/rm-rf2.c98785e5.js">
    <link rel="modulepreload" href="/vitepress-blog/assets/app.f6226b5c.js">
    <link rel="modulepreload" href="/vitepress-blog/assets/index.md.a4942220.lean.js">
    
    <meta name="twitter:title" content="Google zx ä¸­æ–‡ç‰ˆ | ä¸­æ–‡ front-end tech">
  <meta property="og:title" content="Google zx ä¸­æ–‡ç‰ˆ | ä¸­æ–‡ front-end tech">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-675d8756><div class="sidebar-button" data-v-675d8756><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/vitepress-blog/" aria-label="ä¸­æ–‡ front-end tech, back to home" data-v-675d8756 data-v-cc01ef16><!----> ä¸­æ–‡ front-end tech</a><div class="flex-grow" data-v-675d8756></div><div class="nav" data-v-675d8756><nav class="nav-links" data-v-675d8756 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item active" href="/vitepress-blog/zh" data-v-b8818f8c>zx <!----></a></div></div><!--]--><div class="item" data-v-eab3edfe><div class="nav-dropdown-link" data-v-eab3edfe data-v-56bf3a3f><button class="button" data-v-56bf3a3f><span class="button-text" data-v-56bf3a3f>Languages</span><span class="right button-arrow" data-v-56bf3a3f></span></button><ul class="dialog" data-v-56bf3a3f><!--[--><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/vitepress-blog/index.html" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>ä¸­æ–‡</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/vitepress-blog/en/index.html" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>English</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><!--]--></ul></div></div><!----></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-83e92a68><nav class="nav-links nav" data-v-83e92a68 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item active" href="/vitepress-blog/zh" data-v-b8818f8c>zx <!----></a></div></div><!--]--><div class="item" data-v-eab3edfe><div class="nav-dropdown-link" data-v-eab3edfe data-v-56bf3a3f><button class="button" data-v-56bf3a3f><span class="button-text" data-v-56bf3a3f>Languages</span><span class="right button-arrow" data-v-56bf3a3f></span></button><ul class="dialog" data-v-56bf3a3f><!--[--><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/vitepress-blog/index.html" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>ä¸­æ–‡</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/vitepress-blog/en/index.html" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>English</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><!--]--></ul></div></div><!----></nav><!--[--><!--]--><ul class="sidebar-links" data-v-83e92a68><!--[--><li class="sidebar-link"><a class="sidebar-link-item" href="#ç®€ä»‹">ç®€ä»‹</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#èƒŒæ™¯">èƒŒæ™¯</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#æ‰”ç –å¼•ç‰">æ‰”ç –å¼•ç‰</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#å†å²">å†å²</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#ä½¿ç”¨javascriptå†™shellè„šæœ¬">ä½¿ç”¨javascriptå†™shellè„šæœ¬</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#åŸç”Ÿæ–¹å¼child-process">åŸç”Ÿæ–¹å¼child_process</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#shelljsæ‰§è¡Œlinuxå‘½ä»¤è¡Œ">shelljsæ‰§è¡Œlinuxå‘½ä»¤è¡Œ</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#ç”¨spawn-æ¥ç¼–å†™è·¨å¹³å°-node-jså‘½ä»¤">ç”¨spawn æ¥ç¼–å†™è·¨å¹³å° Node.jså‘½ä»¤</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#éƒ¨åˆ†èµ„æ–™å‚è€ƒ">éƒ¨åˆ†èµ„æ–™å‚è€ƒ</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><h1 id="google-zx-ä¸­æ–‡ç‰ˆ" tabindex="-1">Google zx ä¸­æ–‡ç‰ˆ <a class="header-anchor" href="#google-zx-ä¸­æ–‡ç‰ˆ" aria-hidden="true">#</a></h1><img src="/vitepress-blog/assets/programmer-5-years.4deb7709.png" style="width:auto;height:auto;"><h2 id="ç®€ä»‹" tabindex="-1">ç®€ä»‹ <a class="header-anchor" href="#ç®€ä»‹" aria-hidden="true">#</a></h2><p><a href="https://anprettyboy.github.io/handsome-man/" target="_blank" rel="noopener noreferrer">2021å¹´åº¦æœ€æµè¡Œé¡¹ç›®</a>æ˜¯<a href="https://github.com/google/zx" target="_blank" rel="noopener noreferrer">zx</a>ï¼Œä¸€ä¸ªç”±è°·æ­Œæ¨å‡ºçš„å…¨æ–°çš„å·¥å…·ï¼Œå¯ç”¨äºä»¥ JavaScript æˆ– TypeScript ç¼–å†™ç®€å•çš„å‘½ä»¤è¡Œè„šæœ¬ã€‚</p><p>åŸºæœ¬ä¸Šå®ƒå¯ä»¥è®©ä½ åœ¨ä»£ç ä¸­åµŒå…¥ä»»ä½• bash è¡¨è¾¾å¼ï¼ˆls, cat, git...ç­‰ä»»ä½•å‘½ä»¤ï¼ï¼‰ï¼Œå¹¶é€šè¿‡<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/await" target="_blank" rel="noopener noreferrer">awaitæ“ä½œç¬¦</a>ä½¿ç”¨<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals" target="_blank" rel="noopener noreferrer">JavaScript template literals</a>çš„ç»“æœã€‚</p><p>å®ƒå¼•å…¥äº†ç”±å‡ ä¸ªæµè¡Œçš„è½¯ä»¶åŒ…æä¾›çš„å®ç”¨å·¥å…·ï¼š</p><ul><li><a href="https://github.com/node-fetch/node-fetch" target="_blank" rel="noopener noreferrer">node-fetch</a> ä¸æµè§ˆå™¨ä¸­<a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API" target="_blank" rel="noopener noreferrer">Fetch</a>æœ‰ç€ç›¸åŒçš„ APIï¼Œ å¯åˆ›å»º HTTP è¯·æ±‚ã€‚</li><li><a href="https://github.com/jprichardson/node-fs-extra" target="_blank" rel="noopener noreferrer">fs-extra</a> å¯å¤„ç†æ–‡ä»¶ç³»ç»Ÿæ“ä½œã€‚</li><li><a href="https://github.com/sindresorhus/globby" target="_blank" rel="noopener noreferrer">globby</a> ä»¥ç”¨æˆ·å‹å¥½æ¨¡å¼æ¥åŒ¹é…ç»™å®šçš„æ–‡ä»¶åã€‚</li></ul><h2 id="èƒŒæ™¯" tabindex="-1">èƒŒæ™¯ <a class="header-anchor" href="#èƒŒæ™¯" aria-hidden="true">#</a></h2><p>&quot;Bash å¾ˆæ£’ï¼Œä½†æ˜¯åœ¨ç¼–å†™è„šæœ¬æ—¶ï¼Œäººä»¬é€šå¸¸ä¼šé€‰æ‹©æ›´æ–¹ä¾¿çš„ç¼–ç¨‹è¯­è¨€ã€‚ JavaScript æ˜¯ä¸€ä¸ªå®Œç¾çš„é€‰æ‹©ï¼Œä½†æ ‡å‡†çš„ Node.js åº“åœ¨ä½¿ç”¨ä¹‹å‰éœ€è¦é¢å¤–çš„éº»çƒ¦ã€‚ zx åŒ…æä¾›äº†å›´ç»• child_process çš„æœ‰ç”¨åŒ…è£…å™¨ï¼Œè½¬ä¹‰å‚æ•°å¹¶æä¾›åˆç†çš„é»˜è®¤å€¼ã€‚&quot;</p><h3 id="æ‰”ç –å¼•ç‰" tabindex="-1">æ‰”ç –å¼•ç‰ <a class="header-anchor" href="#æ‰”ç –å¼•ç‰" aria-hidden="true">#</a></h3><img src="/vitepress-blog/assets/rm-rf2.748d5332.jpeg" style="width:auto;height:auto;"><p>&quot;æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æœ¬æ¥æƒ³åˆ é™¤ï¼šrm -rf $dir/<em>ç„¶ådiræ˜¯ç©ºçš„æ—¶å€™ï¼Œå˜æˆäº†ä»€ä¹ˆï¼Ÿrm -rfæ˜¯åˆ é™¤å‘½ä»¤ï¼Œ$diræ˜¯ç©ºçš„è¯ï¼Œç›¸å½“äºæ‰§è¡Œ rm -rf /</em>,è¿™æ˜¯åˆ é™¤æ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ã€‚ã€‚ã€‚ç„¶åï¼Œä½ çš„ç³»ç»Ÿå°±æ²¡äº†ï¼Œè¿™å°±æ˜¯ä¼ è¯´ä¸­çš„åˆ åº“è·‘è·¯å—~~~~&quot;</p><h2 id="å†å²" tabindex="-1">å†å² <a class="header-anchor" href="#å†å²" aria-hidden="true">#</a></h2><img src="/vitepress-blog/assets/change.36926f2b.png" style="width:auto;height:auto;"><h3 id="ä½¿ç”¨javascriptå†™shellè„šæœ¬" tabindex="-1">ä½¿ç”¨javascriptå†™shellè„šæœ¬ <a class="header-anchor" href="#ä½¿ç”¨javascriptå†™shellè„šæœ¬" aria-hidden="true">#</a></h3><p>#! æ˜¯ä¸€ä¸ªçº¦å®šçš„æ ‡è®°ï¼Œå®ƒå‘Šè¯‰ç³»ç»Ÿè¿™ä¸ªè„šæœ¬éœ€è¦ä»€ä¹ˆè§£é‡Šå™¨æ¥è¿è¡Œï¼Œå³ï¼šä½¿ç”¨å“ªä¸€ç§ shellã€‚#!è¢«ç§°ä¸º<a href="https://zh.wikipedia.org/wiki/Shebang" target="_blank" rel="noopener noreferrer">shebangï¼ˆä¹Ÿç§°ä¸º Hashbangï¼‰</a>,ä¾‹å¦‚ä½¿ç”¨ bashï¼š#! /bin/bash</p><p>æœ€ç®€å•çš„è„šæœ¬</p><div class="language-shell"><pre><code><span class="token shebang important">#!/usr/bin/env node</span>
console.log<span class="token punctuation">(</span><span class="token string">&#39;hello world&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>ä¿å­˜ä¸ºtestï¼Œæ‰§è¡Œè¯¥è„šæœ¬ node test,ç„¶åå¯ä»¥åœ¨æ§åˆ¶å°è·å¾—è¾“å‡ºã€‚</p><p>æ›´è¿›ä¸€æ­¥ï¼Œæˆ‘ä»¬ç»™è¯¥è„šæœ¬ä¸€ä¸ªæ‰§è¡Œæƒé™ï¼Œ</p><div class="language-shell"><pre><code><span class="token function">chmod</span> <span class="token number">755</span> <span class="token builtin class-name">test</span>
</code></pre></div><h4 id="ä¾‹å­-è¯»å–ç»™å®šæ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰çš„æ–‡ä»¶" tabindex="-1">ä¾‹å­-è¯»å–ç»™å®šæ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰çš„æ–‡ä»¶ <a class="header-anchor" href="#ä¾‹å­-è¯»å–ç»™å®šæ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰çš„æ–‡ä»¶" aria-hidden="true">#</a></h4><p>è¯»å–å½“å‰æ–‡ä»¶å¤¹ä½¿ç”¨ fs.readdirSyncæ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«äº†ç»™å®šæ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰å­æ–‡ä»¶å¤¹æˆ–æ–‡ä»¶,</p><p>ä¸¾ä¸ªæ —å­ï¼Œåœ¨å½“å‰ç›®å½•æˆ‘æœ‰ä¸ªtestæ–‡ä»¶å¤¹</p><div class="language-shell"><pre><code><span class="token builtin class-name">test</span>
â”œâ”€â”€ <span class="token number">1</span>.html
â”œâ”€â”€ <span class="token number">1</span>.txt
â””â”€â”€ files
</code></pre></div><p>fs.readdirSync(&#39;./test&#39;) çš„è¾“å‡ºä¸º [ &#39;1.html&#39;, &#39;1.txt&#39;, &#39;files&#39; ]</p><p>æ–°å»ºä¸ªæ–‡ä»¶ï¼ŒgetFileï¼Œç”¨æ¥å­˜æ”¾è„šæœ¬ä»£ç </p><h4 id="å†™æ­»çš„æ–‡ä»¶å¤¹" tabindex="-1">å†™æ­»çš„æ–‡ä»¶å¤¹ <a class="header-anchor" href="#å†™æ­»çš„æ–‡ä»¶å¤¹" aria-hidden="true">#</a></h4><p>è¯»å–ç»™å®šç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶å¹¶è¾“å‡ºçš„ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-shell"><pre><code><span class="token shebang important">#!/usr/bin/env node</span>

const testFolder <span class="token operator">=</span> <span class="token string">&#39;./test/&#39;</span><span class="token punctuation">;</span>
const fs <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fs.readdirSync<span class="token punctuation">(</span>testFolder<span class="token punctuation">)</span>.forEach<span class="token punctuation">(</span>file <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  console.log<span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="è·å–ç”¨æˆ·è¾“å…¥" tabindex="-1">è·å–ç”¨æˆ·è¾“å…¥ <a class="header-anchor" href="#è·å–ç”¨æˆ·è¾“å…¥" aria-hidden="true">#</a></h4><p>ä»¥ä¸Šä»£ç çš„ç»™å®šçš„è·¯å¾„æ˜¯å†™æ­»çš„ï¼Œæˆ‘ä»¬éœ€è¦ä½œä¸ºå‚æ•°è¾“å…¥ï¼Œnodejsè¯»å–ç”¨æˆ·è¾“å…¥çš„æ–¹æ³•:</p><div class="language-shell"><pre><code>const <span class="token punctuation">[</span>nodeEnv,dir,<span class="token punctuation">..</span>.args<span class="token punctuation">]</span><span class="token operator">=</span>process.argv //argsæ˜¯ç”¨æˆ·è¾“å…¥çš„å‚æ•°
</code></pre></div><p>ä¿®æ”¹è„šæœ¬ä»£ç ï¼š</p><div class="language-shell"><pre><code><span class="token shebang important">#!/usr/bin/env node</span>

const fs <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
const <span class="token punctuation">[</span>nodeEnv,dir,<span class="token punctuation">..</span>.args<span class="token punctuation">]</span><span class="token operator">=</span>process.argv

// è·å–ç”¨æˆ·è¾“å…¥çš„è·¯å¾„
const <span class="token assign-left variable">folder</span><span class="token operator">=</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

fs.readdirSync<span class="token punctuation">(</span>folder<span class="token punctuation">)</span>.forEach<span class="token punctuation">(</span>file <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  console.log<span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>ç°åœ¨æ‰§è¡Œè„šæœ¬æ—¶ï¼Œè·¯å¾„å°±å¯ä»¥è‡ªå·±è¾“å…¥äº†</p><div class="language-shell"><pre><code><span class="token function">node</span> getFile ä½ çš„è·¯å¾„
</code></pre></div><h3 id="åŸç”Ÿæ–¹å¼child-process" tabindex="-1">åŸç”Ÿæ–¹å¼child_process <a class="header-anchor" href="#åŸç”Ÿæ–¹å¼child-process" aria-hidden="true">#</a></h3><p>nodejså¯ä»¥ä½¿ç”¨child_processæ¨¡å—æ–°å»ºå­è¿›ç¨‹ï¼Œç”¨æ¥æ‰§è¡Œunitç³»ç»Ÿå‘½ä»¤ï¼Œå†™ä¸ªæµ‹è¯•çš„ä¾‹å­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-shell"><pre><code><span class="token shebang important">#!/usr/bin/env node</span>


//-----åŒæ­¥å†™æ³•ğŸ‘‡
const <span class="token assign-left variable">execSync</span><span class="token operator">=</span>require<span class="token punctuation">(</span><span class="token string">&#39;child_process&#39;</span><span class="token punctuation">)</span>.execSync

const <span class="token assign-left variable">res</span><span class="token operator">=</span>execSync<span class="token punctuation">(</span><span class="token string">&#39;ls&#39;</span><span class="token punctuation">)</span>
console.log<span class="token punctuation">(</span><span class="token string">&quot;res&quot;</span>, res.toString<span class="token punctuation">(</span><span class="token punctuation">))</span>


// ----- å¼‚æ­¥å†™æ³•ğŸ‘‡
const <span class="token assign-left variable">exec</span><span class="token operator">=</span>require<span class="token punctuation">(</span><span class="token string">&#39;child_process&#39;</span><span class="token punctuation">)</span>.exec
exec<span class="token punctuation">(</span><span class="token string">&#39;ls&#39;</span>,<span class="token punctuation">(</span>err,stdout,stderr<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>
   if<span class="token punctuation">(</span>err<span class="token punctuation">)</span>throw err
   console.log<span class="token punctuation">(</span>stdout<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="shelljsæ‰§è¡Œlinuxå‘½ä»¤è¡Œ" tabindex="-1">shelljsæ‰§è¡Œlinuxå‘½ä»¤è¡Œ <a class="header-anchor" href="#shelljsæ‰§è¡Œlinuxå‘½ä»¤è¡Œ" aria-hidden="true">#</a></h3><p>é¦–å…ˆéœ€è¦å®‰è£…shelljs</p><div class="language-"><pre><code>npm i shelljs -S
</code></pre></div><p>shelljsæä¾›äº†å¾ˆå¤šæ–¹æ³•ï¼Œæœ€å¸¸ç”¨çš„æ˜¯execï¼Œä¸¾ä¸ªæ —å­</p><div class="language-shell"><pre><code>const <span class="token assign-left variable">shell</span><span class="token operator">=</span>require<span class="token punctuation">(</span><span class="token string">&#39;shelljs&#39;</span><span class="token punctuation">)</span>
/**
 * å‡½æ•°ç­¾åï¼šexec<span class="token punctuation">(</span>command <span class="token punctuation">[</span>, options<span class="token punctuation">]</span> <span class="token punctuation">[</span>, callback<span class="token punctuation">]</span><span class="token punctuation">)</span>
 * command:è¦æ‰§è¡Œçš„å‘½ä»¤
 * callback:å›è°ƒå‡½æ•°ï¼Œå¯¹commandçš„è¾“å‡ºè¿›è¡Œå¤„ç†
 * options:
 *  async: å¼‚æ­¥æ‰§è¡Œ.å¦‚æœcallbackæä¾›äº†ï¼Œä¼šå¿½ç•¥è¯¥å‚æ•°å¹¶å¼ºåˆ¶å¼‚æ­¥æ‰§è¡Œ  <span class="token punctuation">(</span>default: <span class="token boolean">false</span><span class="token punctuation">)</span>
 *  fatal: Exit upon error <span class="token punctuation">(</span>default: <span class="token boolean">false</span><span class="token punctuation">)</span>.
 *  silent: ä¸åœ¨consoleä¸­è¾“å‡º<span class="token punctuation">(</span>default: <span class="token boolean">false</span><span class="token punctuation">)</span>.
 *  encoding: è®¾ç½®stdoutå’Œstderrçš„ç¼–ç  <span class="token punctuation">(</span>default: <span class="token string">&#39;utf8&#39;</span><span class="token punctuation">)</span>
 */

//è¾“å‡ºlsçš„ç»“æœ
shell.exec<span class="token punctuation">(</span><span class="token string">&quot;ls&quot;</span><span class="token punctuation">)</span>

//callback<span class="token punctuation">(</span>code,stdout,stderr<span class="token punctuation">)</span>  codeä¸º0åˆ™æˆåŠŸï¼Œå¦åˆ™å¤±è´¥
shell.exec<span class="token punctuation">(</span><span class="token string">&quot;dir&quot;</span>,<span class="token punctuation">{</span>silent:true<span class="token punctuation">}</span>,<span class="token punctuation">(</span>code,stdout,stderr<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

shell.exec<span class="token punctuation">(</span><span class="token string">&#39;ls&#39;</span>,<span class="token punctuation">{</span>silent:true<span class="token punctuation">}</span>,<span class="token punctuation">(</span>code,stdout,stderr<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>
    console.log<span class="token punctuation">(</span>code<span class="token punctuation">)</span>
    console.log<span class="token punctuation">(</span>stdout<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><img src="/vitepress-blog/assets/computer-learn.0cde64fa.jpeg" style="width:auto;height:auto;"><p>åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¸¸ä¼šé‡åˆ°å¦‚ä¸‹å‘½ä»¤ï¼š</p><div class="language-shell"><pre><code><span class="token function">git</span> <span class="token function">add</span> <span class="token builtin class-name">.</span>
<span class="token function">git</span> commit -m <span class="token string">&#39;*****&#39;</span>
<span class="token function">git</span> push
</code></pre></div><ol><li>åœ¨æ ¹ç›®å½•ä¸‹æ–°å»ºæ–‡ä»¶shell.jsï¼Œå†…å®¹å¦‚ä¸‹ï¼š</li></ol><div class="language-shell"><pre><code><span class="token builtin class-name">let</span> shell <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">&#39;shelljs&#39;</span><span class="token punctuation">)</span>
<span class="token builtin class-name">let</span> name <span class="token operator">=</span> process.argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token string">&#39;Auto-commit&#39;</span><span class="token punctuation">;</span>
<span class="token builtin class-name">let</span> <span class="token builtin class-name">exec</span> <span class="token operator">=</span> shell.exec

<span class="token keyword">if</span> <span class="token punctuation">(</span>exec<span class="token punctuation">(</span><span class="token string">&#39;git add .&#39;</span><span class="token punctuation">)</span>.code <span class="token operator">!=</span><span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    echo<span class="token punctuation">(</span><span class="token string">&#39;Error: Git add failed&#39;</span><span class="token punctuation">)</span>
    exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>exec<span class="token punctuation">(</span><span class="token variable"><span class="token variable">`</span><span class="token function">git</span> commit -am <span class="token string">&quot;<span class="token variable">${name}</span>&quot;</span><span class="token variable">`</span></span><span class="token punctuation">)</span>.code <span class="token operator">!=</span><span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    echo<span class="token punctuation">(</span><span class="token string">&#39;Error: Git commit failed&#39;</span><span class="token punctuation">)</span>
    exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>exec<span class="token punctuation">(</span><span class="token string">&#39;git push&#39;</span><span class="token punctuation">)</span>.code <span class="token operator">!=</span><span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    echo<span class="token punctuation">(</span><span class="token string">&#39;Error: Git commit failed&#39;</span><span class="token punctuation">)</span>
    exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>åªç”¨ä¸€æ¡å‘½ä»¤æ‰§è¡Œä»¥ä¸Šæ‰€æœ‰ä»»åŠ¡ï¼Œåœ¨package.jsonä¸­åŠ å…¥,æ–¹æ³•å¦‚ä¸‹:</li></ol><div class="language-shell"><pre><code><span class="token string">&quot;script&quot;</span>:<span class="token punctuation">{</span>
    <span class="token string">&quot;push&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;node ./shell.js&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>æ‰§è¡Œ</li></ol><div class="language-shell"><pre><code><span class="token function">npm</span> run push æµ‹è¯•shelljsæäº¤ä»£ç 
</code></pre></div><h3 id="ç”¨spawn-æ¥ç¼–å†™è·¨å¹³å°-node-jså‘½ä»¤" tabindex="-1">ç”¨spawn æ¥ç¼–å†™è·¨å¹³å° Node.jså‘½ä»¤ <a class="header-anchor" href="#ç”¨spawn-æ¥ç¼–å†™è·¨å¹³å°-node-jså‘½ä»¤" aria-hidden="true">#</a></h3><p>å¦‚æœæƒ³è¦ç¼–å†™è·¨å¹³å°çš„ spawn å‘½ä»¤ï¼Œè€Œåˆä¸æƒ³å¢åŠ é¢å¤–çš„å¼€é”€çš„è¯ï¼Œå¯ä»¥è¿™æ ·å†™</p><div class="language-shell"><pre><code>const process <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">&#39;process&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
const <span class="token punctuation">{</span> spawn <span class="token punctuation">}</span> <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">&#39;child_process&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

spawn<span class="token punctuation">(</span><span class="token string">&#39;npm&#39;</span>, <span class="token punctuation">{</span>
 stdio: <span class="token string">&#39;inherit&#39;</span>,
 // ä»…åœ¨å½“å‰è¿è¡Œç¯å¢ƒä¸º Windows æ—¶ï¼Œæ‰ä½¿ç”¨ shell
 shell: process.platform <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">&#39;win32&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h4 id="cross-spawnç¬¬ä¸‰æ–¹æ¨¡å—" tabindex="-1">cross-spawnç¬¬ä¸‰æ–¹æ¨¡å— <a class="header-anchor" href="#cross-spawnç¬¬ä¸‰æ–¹æ¨¡å—" aria-hidden="true">#</a></h4><p>å…³äº spawn å‡½æ•°çš„è·¨å¹³å°å†™æ³•ï¼Œé™¤äº†è‡ªå·±ç¼–å†™ä»£ç çš„æ—¶å€™åšå¤„ç†ï¼Œä¹Ÿæœ‰ç¬¬ä¸‰æ–¹æ¨¡å—å°è£…å¥½äº†ç›¸å…³ç»†èŠ‚ï¼Œå¦‚ cross-spawnã€‚</p><p>ä½¿ç”¨è¯¥æ¨¡å—ï¼Œå¯ä»¥åœ¨è°ƒç”¨ spawn å‡½æ•°æ—¶ï¼Œè‡ªåŠ¨æ ¹æ®å½“å‰çš„è¿è¡Œå¹³å°ï¼Œæ¥å†³å®šæ˜¯å¦ç”Ÿæˆä¸€ä¸ª shell æ¥æ‰§è¡Œæ‰€ç»™çš„å‘½ä»¤ã€‚å¯¹å‘½ä»¤å’Œå‚æ•°ä¸­çš„å­—ç¬¦è¿›è¡Œè½¬ä¹‰æ›´ä¸ºæ–¹ä¾¿ã€‚</p><img src="/vitepress-blog/assets/avoid-rm.bac3b5ca.jpeg" style="width:auto;height:auto;"> ### Google zx <p>â€œBashå¾ˆå¥½ï¼Œæ‰€ä»¥æˆ‘é€‰æ‹©JavaScriptâ€</p><p>å‰ç«¯å¼€å‘æ‹¿æ‰‹çš„ä¸å°±æ˜¯ Javascript, å—¯ å¼€æ•´</p><h4 id="å®‰è£…å’Œä½¿ç”¨" tabindex="-1">å®‰è£…å’Œä½¿ç”¨ <a class="header-anchor" href="#å®‰è£…å’Œä½¿ç”¨" aria-hidden="true">#</a></h4><div class="language-shell"><pre><code><span class="token function">npm</span> i -g zx
</code></pre></div><p>å®‰è£…å¥½ zx ä¹‹åï¼Œå°†ç¼–å†™çš„è„šæœ¬æ”¾åœ¨ .mjs åç¼€çš„æ–‡ä»¶ä¸­ï¼Œæˆ–è€…ä½¿ç”¨ .js åç¼€ï¼Œä½†æ˜¯éœ€è¦ä½¿ç”¨ void async function () {...}() å¯¹è„šæœ¬è¿›è¡ŒåŒ…è£…ã€‚</p><p>ä½¿ç”¨æ—¶éœ€æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p><h4 id="_1ã€è„šæœ¬éœ€è¦åŒ…å«ä»¥ä¸‹æ–‡ä»¶å¤´ï¼š" tabindex="-1">1ã€è„šæœ¬éœ€è¦åŒ…å«ä»¥ä¸‹æ–‡ä»¶å¤´ï¼š <a class="header-anchor" href="#_1ã€è„šæœ¬éœ€è¦åŒ…å«ä»¥ä¸‹æ–‡ä»¶å¤´ï¼š" aria-hidden="true">#</a></h4><div class="language-"><pre><code>#!/usr/bin/env zx
</code></pre></div><h4 id="_2-ä¸ºè„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™å†è¿è¡Œ" tabindex="-1">2. ä¸ºè„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™å†è¿è¡Œ <a class="header-anchor" href="#_2-ä¸ºè„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™å†è¿è¡Œ" aria-hidden="true">#</a></h4><div class="language-"><pre><code>$ chmod +x ./script.mjs
$ ./script.mjs

# æˆ–è€…ä½¿ç”¨è¿™ä¸ªå‘½ä»¤
$ zx ./script.mjs
</code></pre></div><h4 id="zx-å¸¸ç”¨å‘½ä»¤" tabindex="-1">zx å¸¸ç”¨å‘½ä»¤ <a class="header-anchor" href="#zx-å¸¸ç”¨å‘½ä»¤" aria-hidden="true">#</a></h4><h5 id="command" tabindex="-1">$<code>command</code> <a class="header-anchor" href="#command" aria-hidden="true">#</a></h5><p>ä½¿ç”¨ child_process åŒ…ä¸­æä¾›çš„ exec å‡½æ•°ï¼Œå¯ä»¥æŠŠå­—ç¬¦ä¸²å½“åšå‘½ä»¤æ‰§è¡Œï¼Œå¹¶è¿”å›ä¸€ä¸ª Promise(ProcessOutput) å¯¹è±¡ã€‚é€šè¿‡çš„ä¸€åˆ‡${...}éƒ½ä¼šè¢«è‡ªåŠ¨è½¬ä¹‰å’Œå¼•ç”¨ã€‚</p><div class="language-shell"><pre><code><span class="token builtin class-name">let</span> count <span class="token operator">=</span> parseInt<span class="token punctuation">(</span>await $<span class="token variable"><span class="token variable">`</span><span class="token function">ls</span> -1 <span class="token operator">|</span> <span class="token function">wc</span> -l<span class="token variable">`</span></span><span class="token punctuation">)</span>
console.log<span class="token punctuation">(</span><span class="token variable"><span class="token variable">`</span>Files count: $<span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token variable">`</span></span><span class="token punctuation">)</span>
</code></pre></div><p>è¦å¹¶è¡Œä¸Šä¼ æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„è„šæœ¬ï¼š</p><div class="language-shell"><pre><code><span class="token builtin class-name">let</span> hosts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">..</span>.<span class="token punctuation">]</span>
await Promise.all<span class="token punctuation">(</span>hosts.map<span class="token punctuation">(</span>host <span class="token operator">=</span><span class="token operator">&gt;</span>
  $<span class="token variable"><span class="token variable">`</span><span class="token function">rsync</span> -azP ./src $<span class="token punctuation">{</span>host<span class="token punctuation">}</span>:/var/www<span class="token variable">`</span></span>
<span class="token punctuation">))</span>
</code></pre></div><p>è¦ä¿®æ”¹å·¥ä½œè·¯å¾„ï¼Œå¯ä»¥ä½¿ç”¨ cd() æ–¹æ³•ï¼š</p><div class="language-shell"><pre><code>cd<span class="token punctuation">(</span><span class="token string">&#39;/tmp&#39;</span><span class="token punctuation">)</span>
// å°†è¾“å‡º /tmp
await $<span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">pwd</span><span class="token variable">`</span></span>
</code></pre></div><p>fetch() æ–¹æ³•æ˜¯å¯¹ node-fetch åŒ…çš„åŒ…è£…ï¼š</p><div class="language-shell"><pre><code><span class="token builtin class-name">let</span> resp <span class="token operator">=</span> await fetch<span class="token punctuation">(</span><span class="token string">&#39;http://wttr.in&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>resp.ok<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console.log<span class="token punctuation">(</span>await resp.text<span class="token punctuation">(</span><span class="token punctuation">))</span>
<span class="token punctuation">}</span>
</code></pre></div><p>question() æ–¹æ³•æ˜¯å¯¹ readline åŒ…çš„åŒ…è£…ï¼š</p><div class="language-shell"><pre><code><span class="token builtin class-name">type</span> QuestionOptions <span class="token operator">=</span> <span class="token punctuation">{</span> choices: string<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
<span class="token keyword">function</span> question<span class="token punctuation">(</span>query: string, options?: QuestionOptions<span class="token punctuation">)</span>: Promise<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span>
</code></pre></div><p>ç”¨æ³•ï¼š</p><div class="language-shell"><pre><code><span class="token builtin class-name">let</span> username <span class="token operator">=</span> await question<span class="token punctuation">(</span><span class="token string">&#39;What is your username? &#39;</span><span class="token punctuation">)</span>
<span class="token builtin class-name">let</span> token <span class="token operator">=</span> await question<span class="token punctuation">(</span><span class="token string">&#39;Choose env variable: &#39;</span>, <span class="token punctuation">{</span>
  choices: Object.keys<span class="token punctuation">(</span>process.<wbr>env<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>å¯¹äº chalk åŒ…ï¼Œä¸éœ€è¦å¯¼å…¥å°±å¯ä»¥ç›´æ¥ç”¨ï¼š</p><div class="language-shell"><pre><code>console.log<span class="token punctuation">(</span>chalk.blue<span class="token punctuation">(</span><span class="token string">&#39;Hello world!&#39;</span><span class="token punctuation">))</span>
</code></pre></div><p>fs åŒ…ï¼Œå¯¼å…¥å°±å¯ä»¥ç›´æ¥ç”¨ï¼š</p><div class="language-shell"><pre><code><span class="token builtin class-name">let</span> content <span class="token operator">=</span> await fs.readFile<span class="token punctuation">(</span><span class="token string">&#39;./package.json&#39;</span><span class="token punctuation">)</span>
</code></pre></div><p>Promisified é»˜è®¤è¢«å¼•å…¥äº†ï¼Œç­‰åŒäºä»¥ä¸‹ä»£ç ï¼š</p><div class="language-shell"><pre><code><span class="token function">import</span> <span class="token punctuation">{</span>promises as fs<span class="token punctuation">}</span> from <span class="token string">&#39;fs&#39;</span>
</code></pre></div><p>os åŒ…ï¼Œå¯¼å…¥å°±å¯ä»¥ç›´æ¥ç”¨ï¼š</p><div class="language-shell"><pre><code>await $<span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">cd</span> $<span class="token punctuation">{</span>os.homedir<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">&amp;&amp;</span> <span class="token function">mkdir</span> example<span class="token variable">`</span></span>
</code></pre></div><p>zx è¿˜å¯ä»¥ä»å…¶ä»–è„šæœ¬å¯¼å…¥ï¼š</p><div class="language-shell"><pre><code><span class="token shebang important">#!/usr/bin/env node</span>
<span class="token function">import</span> <span class="token punctuation">{</span>$<span class="token punctuation">}</span> from <span class="token string">&#39;zx&#39;</span>
await $<span class="token variable"><span class="token variable">`</span><span class="token function">date</span><span class="token variable">`</span></span>
</code></pre></div><p>ä¼ é€’ç¯å¢ƒå˜é‡ï¼š</p><div class="language-shell"><pre><code>process.<wbr>env.FOO <span class="token operator">=</span> <span class="token string">&#39;bar&#39;</span>
await $<span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">echo</span> $FOO<span class="token variable">`</span></span>
</code></pre></div><p>æ‰§è¡Œè¿œç¨‹è„šæœ¬ï¼š</p><div class="language-shell"><pre><code>zx https://your-remote-server.com/example-script.mjs
</code></pre></div><h3 id="éƒ¨åˆ†èµ„æ–™å‚è€ƒ" tabindex="-1">éƒ¨åˆ†èµ„æ–™å‚è€ƒ <a class="header-anchor" href="#éƒ¨åˆ†èµ„æ–™å‚è€ƒ" aria-hidden="true">#</a></h3><ul><li><a href="https://www.sitepoint.com/google-zx-write-node-shell-scripts/" target="_blank" rel="noopener noreferrer">How to Write Shell Scripts in Node with Googleâ€™s zx Library</a></li><li><a href="https://juejin.cn/post/6987307041321091079" target="_blank" rel="noopener noreferrer">shelljså‰ç«¯è‡ªåŠ¨åŒ–</a></li><li><a href="https://juejin.cn/post/6992743763844005902" target="_blank" rel="noopener noreferrer">ä½¿ç”¨javascriptå†™shellè„šæœ¬</a></li><li><a href="https://juejin.cn/post/6979989936137043999" target="_blank" rel="noopener noreferrer">nodejså†™bashè„šæœ¬ç»ˆææ–¹æ¡ˆï¼</a></li><li><a href="https://juejin.cn/post/7048286354861457416" target="_blank" rel="noopener noreferrer">ZX ç”¨JavaScriptå†™bashè„šæœ¬</a></li><li><a href="https://juejin.cn/post/6979989936137043999#heading-4" target="_blank" rel="noopener noreferrer">nodejså†™bashè„šæœ¬ç»ˆææ–¹æ¡ˆï¼</a></li><li><a href="https://juejin.cn/post/7011464539141046279" target="_blank" rel="noopener noreferrer">zx, å¦‚ä½•ç”¨Javascriptä¼˜é›…çš„ä¹¦å†™è„šæœ¬å‘½ä»¤</a></li><li><a href="https://juejin.cn/post/7002536429314277384" target="_blank" rel="noopener noreferrer">Google zx æºç æµ…æ</a></li><li><a href="https://atomcloud.cn/google-script-tool-zx/" target="_blank" rel="noopener noreferrer">Google è„šæœ¬å·¥å…· zx ä½¿ç”¨æ•™ç¨‹</a></li><li><a href="https://www.sitepoint.com/google-zx-write-node-shell-scripts/" target="_blank" rel="noopener noreferrer">How to Write Shell Scripts in Node with Googleâ€™s zx Library</a></li><li><a href="https://www.infoq.com/news/2021/05/zx-javascript-cli-scripts/" target="_blank" rel="noopener noreferrer">Zx - a Tool for Writing Better Scripts</a></li><li><a href="https://blog.tericcabrel.com/write-a-better-bash-script-with-zx/" target="_blank" rel="noopener noreferrer">Write better bash scripts with Zx</a></li><li><a href="https://blog.mastykarz.nl/create-scripts-javascript-zx/" target="_blank" rel="noopener noreferrer">Create scripts in JavaScript with zx</a></li><li><a href="https://www.mo4tech.com/google-zx-source-code-analysis.html" target="_blank" rel="noopener noreferrer">Google ZX source code analysis</a></li></ul></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-fb8d84c6><div class="edit" data-v-fb8d84c6><div class="edit-link" data-v-fb8d84c6 data-v-1ed99556><!----></div></div><div class="updated" data-v-fb8d84c6><p class="last-updated" data-v-fb8d84c6 data-v-5797b537><span class="prefix" data-v-5797b537>Last Updated:</span><span class="datetime" data-v-5797b537></span></p></div></footer><!----><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"en.md\":\"6c014f35\",\"index.md\":\"a4942220\"}")</script>
    <script type="module" async src="/vitepress-blog/assets/app.f6226b5c.js"></script>
    
  </body>
</html>